import{a as D}from"./axios.ab682c6b.js";import{r as k,f as b,w as O,T as p,$,R as m,n as v,p as _,v as h,W as q,a0 as B,F as T,B as V,C as N,Z as G,s as i,t as z,z as L,U as W,_ as J,J as U,e as Z,M as Q,K as X,l as M,q as P,u as I,G as Y}from"./index.79c4e3e8.js";var ee={show:"Show",entries:"entries",previous:"Previous",next:"Next",showing:"Showing",showingTo:"to",showingOf:"of",showingEntries:"entries"};const K="...";function te(t,s,n){let e;return function(){const r=this,l=arguments;clearTimeout(e),n&&!e&&t.apply(r,l),e=setTimeout(function(){e=null,n||t.apply(r,l)},s)}}function j(t){for(const s in t)return!1;return!0}function se(t,s){const e=[],r=[];let l;if(e.push(1),t<=1)return e;for(let a=s-2;a<=s+2;a++)a<t&&a>1&&e.push(a);e.push(t);for(let a=0;a<e.length;a++)l&&(e[a]-l===2?r.push(l+1):e[a]-l!==1&&r.push(K)),r.push(e[a]),l=e[a];return r}function ae(t,s={}){const n=[];let e;const r=t.length;return t=t.map(function(l,a){return l[0]==="-"?(n[a]=-1,l=l.substring(1)):n[a]=1,l}),function(l,a){for(e=0;e<r;e++){const g=t[e],y=s[g]?s[g](l.value[g]):l.value[g],x=s[g]?s[g](a.value[g]):a.value[g];if(y>x)return n[e];if(y<x)return-n[e]}return 0}}function ne(t,s){for(const n in s)t=t.filter(function(e){const r=e.value;for(const l in r)if(l===n){if(typeof s[n]=="function")return s[n](r[l]);if(s[n]===""||r[l]===s[n])return!0}return!1});return t}function oe(t,s,n,e){e=String(e).toLowerCase();for(const r in n)if(t.length===0||t.indexOf(r)!==-1){const l=String(n[r]).toLowerCase();for(const a in s)if(a===r&&typeof s[a]=="function"){const g=s[a](l,e,n);if(g===!0)return g}if(l.indexOf(e)>=0)return!0}return!1}var C=(t,s)=>{for(const[n,e]of s)t[n]=e;return t};const le={props:{dsData:{type:Array,default:()=>[]},dsFilterFields:{type:Object,default:()=>({})},dsSortby:{type:Array,default:()=>[]},dsSearchIn:{type:Array,default:()=>[]},dsSearchAs:{type:Object,default:()=>({})},dsSortAs:{type:Object,default:()=>({})}},setup(t){const s=k(1),n=k(""),e=k(10),r=k(ee),l=k([]),a=o=>{n.value=o},g=async o=>{const u=S.value;e.value=o,await W();const f=S.value;f.length<u.length&&y(f[f.length-1])},y=o=>{s.value=o},x=b(()=>(t.dsData,n.value,t.dsSortby,t.dsFilterFields,t.dsSearchIn,t.dsSearchAs,t.dsSortAs,Date.now())),F=b(()=>l.value.slice(R.value,d.value)),S=b(()=>se(A.value,s.value)),E=b(()=>l.value.length),A=b(()=>Math.ceil(E.value/e.value)),R=b(()=>(s.value-1)*e.value),d=b(()=>s.value*e.value);return O(E,(o,u)=>{y(1)}),O(x,(o,u)=>{let f=[];!n.value&&!t.dsSortby.length&&j(t.dsFilterFields)?f=t.dsData.map((c,w)=>w):(f=t.dsData.map((c,w)=>({index:w,value:c})),j(t.dsFilterFields)||(f=ne(f,t.dsFilterFields)),n.value&&(f=f.filter(c=>oe(t.dsSearchIn,t.dsSearchAs,c.value,n.value))),t.dsSortby.length&&f.sort(ae(t.dsSortby,t.dsSortAs)),f=f.map(c=>c.index)),l.value=f},{immediate:!0}),p("dsIndexes",l),p("search",a),p("showEntries",g),p("setActive",y),p("datasetI18n",r),p("dsData",b(()=>t.dsData)),p("dsRows",F),p("dsPages",S),p("dsResultsNumber",E),p("dsPagecount",A),p("dsFrom",R),p("dsTo",d),p("dsPage",s),{dsIndexes:l,dsShowEntries:e,dsResultsNumber:E,dsPage:s,dsPagecount:A,dsFrom:R,dsTo:d,dsRows:F,dsPages:S,search:a,showEntries:g,setActive:y}}};function ie(t,s,n,e,r,l){return $(t.$slots,"default",{ds:{dsIndexes:e.dsIndexes,dsShowEntries:e.dsShowEntries,dsResultsNumber:e.dsResultsNumber,dsPage:e.dsPage,dsPagecount:e.dsPagecount,dsFrom:e.dsFrom,dsTo:e.dsTo,dsData:n.dsData,dsRows:e.dsRows,dsPages:e.dsPages,search:e.search,showEntries:e.showEntries,setActive:e.setActive}})}var re=C(le,[["render",ie]]);const de={setup(){const t=m("dsResultsNumber"),s=m("dsFrom"),n=m("dsTo"),e=b(()=>t.value!==0?s.value+1:0),r=b(()=>n.value>=t.value?t.value:n.value);return{datasetI18n:m("datasetI18n"),dsResultsNumber:t,showing:e,showingTo:r}}};function ce(t,s,n,e,r,l){return v(),_("div",null,h(e.datasetI18n.showing)+" "+h(e.showing)+" "+h(e.datasetI18n.showingTo)+" "+h(e.showingTo)+" "+h(e.datasetI18n.showingOf)+" "+h(e.dsResultsNumber)+" "+h(e.datasetI18n.showingEntries),1)}var ue=C(de,[["render",ce]]);const fe={props:{tag:{type:String,default:"div"}},setup(){const t=b(()=>{const s=[];for(let n=m("dsFrom").value;n<m("dsTo").value;n++)s.push(n);return s});return{dsData:m("dsData"),dsRows:m("dsRows"),indexes:t}}};function he(t,s,n,e,r,l){return v(),q(G(n.tag),null,{default:B(()=>[(v(!0),_(T,null,V(e.dsRows,(a,g)=>$(t.$slots,"default",{row:e.dsData[a],rowIndex:a,index:e.indexes[g]})),256)),e.dsRows.length?N("",!0):$(t.$slots,"noDataFound",{key:0})]),_:3})}var ve=C(fe,[["render",he]]);const ge={setup(){const t=k(K),s=m("dsPage"),n=m("dsPagecount"),e=b(()=>s.value===1),r=b(()=>s.value===n.value||n.value===0);return{datasetI18n:m("datasetI18n"),setActive:m("setActive"),dsPages:m("dsPages"),dsPagecount:n,dsPage:s,morePages:t,disabledPrevious:e,disabledNext:r}}},_e={class:"pagination"},me=["tabindex","aria-disabled"],be=["onClick"],pe={key:1,class:"page-link"},ye=["tabindex","aria-disabled"];function xe(t,s,n,e,r,l){return v(),_("ul",_e,[i("li",{class:L(["page-item",e.disabledPrevious&&"disabled"])},[i("a",{class:"page-link",href:"#",tabindex:e.disabledPrevious?"-1":null,"aria-disabled":e.disabledPrevious?"true":null,onClick:s[0]||(s[0]=z(a=>e.setActive(e.dsPage!==1&&e.dsPagecount!==0?e.dsPage-1:e.dsPage),["prevent"]))},h(e.datasetI18n.previous),9,me)],2),(v(!0),_(T,null,V(e.dsPages,(a,g)=>(v(),_("li",{key:g,class:L(["page-item",a===e.dsPage&&"active",a===e.morePages&&"disabled"])},[a!==e.morePages?(v(),_("a",{key:0,class:"page-link",href:"#",onClick:z(y=>e.setActive(a),["prevent"])},h(a),9,be)):(v(),_("span",pe,h(a),1))],2))),128)),i("li",{class:L(["page-item",e.disabledNext&&"disabled"])},[i("a",{class:"page-link",href:"#",tabindex:e.disabledNext?"-1":null,"aria-disabled":e.disabledNext?"true":null,onClick:s[1]||(s[1]=z(a=>e.setActive(e.dsPage!==e.dsPagecount&&e.dsPagecount!==0?e.dsPage+1:e.dsPage),["prevent"]))},h(e.datasetI18n.next),9,ye)],2)])}var we=C(ge,[["render",xe]]);const Pe={props:{dsSearchPlaceholder:{type:String,default:""},wait:{type:Number,default:0}},setup(t){const s=m("search"),n=k(""),e=te(r=>{s(r)},t.wait);return{dsSearch:n,input:e}}},ke=["placeholder","value"];function Se(t,s,n,e,r,l){return v(),_("input",{type:"text",placeholder:n.dsSearchPlaceholder,class:"form-control",value:e.dsSearch,onInput:s[0]||(s[0]=a=>e.input(a.target.value))},null,40,ke)}var Ee=C(Pe,[["render",Se]]);const Ie={props:{dsShowEntries:{type:Number,default:10},dsShowEntriesLovs:{type:Array,default:()=>[{value:5,text:5},{value:10,text:10},{value:25,text:25},{value:50,text:50},{value:100,text:100}]}},emits:["changed"],setup(t,{emit:s}){const n=m("showEntries"),e=r=>{s("changed",Number(r.target.value)),n(Number(r.target.value))};return n(Number(t.dsShowEntries)),{datasetI18n:m("datasetI18n"),change:e}}},Ce={class:"form-inline"},Ae=["value"],Re=["value"];function De(t,s,n,e,r,l){return v(),_("div",Ce,[i("label",null,h(e.datasetI18n.show),1),i("select",{value:n.dsShowEntries,class:"form-control mr-1 ml-1",onChange:s[0]||(s[0]=(...a)=>e.change&&e.change(...a))},[(v(!0),_(T,null,V(n.dsShowEntriesLovs,a=>(v(),_("option",{key:a.value,value:a.value},h(a.text),9,Re))),128))],40,Ae),i("label",null,h(e.datasetI18n.entries),1)])}var Ne=C(Ie,[["render",De]]);const Te={class:"content"},Fe=["data-page-count"],Be={id:"datasetLength",class:"col-md-8 py-2"},Le={class:"col-md-4 py-2"},Ve={class:"row"},ze={class:"col-md-12"},$e={class:"table-responsive"},Oe={class:"table table-hover mb-0"},je=["onClick"],Me={scope:"row"},Ke={style:{"min-width":"150px"}},He={style:{"min-width":"150px"}},qe={style:{"min-width":"150px"}},Ge={style:{"min-width":"150px"}},We={key:0,class:"fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-success-light text-success"},Je={key:1,class:"fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-info-light text-info"},Ue={key:2,class:"fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill bg-warning-light text-warning"},Ze=["onClick"],Qe=["onClick"],Xe=["onClick"],Ye=["onClick"],et={class:"d-flex flex-md-row flex-column justify-content-between align-items-center"},tt={__name:"TablaReserva",setup(t){const s=()=>({headers:{"x-token":sessionStorage.getItem("especialista-token")}}),e=U().params.uid,r="https://apirest.agendafree.cl/api/",l=k(""),a=k(),g=async()=>{await D.get(r+"users/uid/"+e,s()).then(d=>{d.data.personas[0].profesionales[0].habilitado==!0&&d.data.personas[0].profesionales[0].ruta_api&&(l.value=d.data.personas[0].profesionales[0].ruta_api,console.log("API_ESPECIALISTA: ",l.value),y(d.data.personas[0].profesionales[0].ruta_api))}).catch(d=>{console.log(d)})},y=d=>{D.get(d+"/api/cita",s()).then(o=>{o&&(a.value=o.data.allCitas,a.value=a.value.map(u=>({id:u.id,nombre_persona:u.persona.nombre+" "+u.persona.apellido,fecha:u.fecha,prevision:u.previsione.nombre,hora:u.horas_disponible.hora,estado:{id:u.estados_cita.id,nombre:u.estados_cita.estado}})),console.log("citas: ",a.value))}).catch(o=>{console.log(o)})},x=Z([{name:"Paciente",field:"paciente",sort:""},{name:"Dia",field:"dia",sort:""},{name:"Hora",field:"hora",sort:""},{name:"Prevision",field:"prevision",sort:""},{name:"Estado",field:"estado",sort:""},{name:"Acciones",field:"",sort:""}]),F=b(()=>x.reduce((d,o)=>(o.sort&&(o.sort==="asc"?d.push(o.field):d.push("-"+o.field)),d),[]));function S(d,o){let u;const f=x[o];d.shiftKey||x.forEach(c=>{c.field!==f.field&&(c.sort="")}),f.sort||(u="asc"),f.sort==="desc"&&(u=d.shiftKey?"":"asc"),f.sort==="asc"&&(u="desc"),f.sort=u}Q(()=>{document.querySelectorAll("#datasetLength label").forEach(o=>{o.remove()});let d=document.querySelector("#datasetLength select");d.classList="",d.classList.add("form-select"),d.style.width="80px"});const E=d=>{console.log(`${l.value}api/rechazar-cita/${d}`),D.put(`${l.value}api/rechazar-cita/${d}`,s()).then(o=>{o.data.success&&(a.value=a.value.filter(u=>u.id!==d))}).catch(o=>{console.error("Error al rechazar la cita:",o)})},A=d=>{D.put(`${l.value}api/cita/bono/${d}`,s()).then(o=>{if(o){console.log("Cita actualizada: ",o.data);const u=a.value.find(f=>f.id===d);u&&(u.estado.id=2)}}).catch(o=>{console.error("Error al solicitar abono:",o)})},R=d=>{D.put(`${l.value}api/confirmar-cita/${d}`,s()).then(o=>{o.data.success&&(a.value=a.value.filter(u=>u.id!==d))}).catch(o=>{console.error("Error al confirmar la cita:",o)})};return X(async()=>{await g()}),(d,o)=>{const u=M("BaseBlock");return v(),_("div",Te,[P(u,{title:"Solicitudes sin gestionar","content-full":""},{default:B(()=>[P(I(re),{"ds-data":a.value,"ds-sortby":F.value,"ds-search-in":["paciente","dia","hora","prevision","estado"]},{default:B(({ds:f})=>[i("div",{class:"row","data-page-count":f.dsPagecount},[i("div",Be,[P(I(Ne),{"ds-show-entries":5})]),i("div",Le,[P(I(Ee),{"ds-search-placeholder":"Buscar..."})])],8,Fe),o[6]||(o[6]=i("hr",null,null,-1)),i("div",Ve,[i("div",ze,[i("div",$e,[i("table",Oe,[i("thead",null,[i("tr",null,[o[1]||(o[1]=i("th",{scope:"col"},"ID",-1)),(v(!0),_(T,null,V(x,(c,w)=>(v(),_("th",{key:c.field,class:L(["sort",c.sort]),onClick:H=>S(H,w)},[Y(h(c.name)+" ",1),o[0]||(o[0]=i("i",{class:"gg-select float-end"},null,-1))],10,je))),128))])]),P(I(ve),{tag:"tbody",class:"fs-sm"},{default:B(({row:c})=>[i("tr",null,[i("th",Me,h(c.id),1),i("td",Ke,h(c.nombre_persona),1),i("td",null,h(c.dia),1),i("td",He,h(c.hora),1),i("td",qe,h(c.prevision),1),i("td",Ge,[c.estado.id===1?(v(),_("span",We,h(c.estado.nombre),1)):N("",!0),c.estado.id===2?(v(),_("span",Je,h(c.estado.nombre),1)):N("",!0),c.estado.id===3?(v(),_("span",Ue,h(c.estado.nombre),1)):N("",!0)]),i("td",null,[c.estado.id==1?(v(),_("button",{key:0,type:"button",class:"btn btn-sm btn-alt-primary m-1",style:{width:"auto","min-width":"60px"},onClick:w=>A(c.id)},o[2]||(o[2]=[i("span",{class:"d-none d-lg-inline"},"Solicitud abono",-1),i("i",{class:"fa fa-money-check-dollar d-lg-none"},null,-1)]),8,Ze)):c.estado.id==2?(v(),_("button",{key:1,type:"button",class:"btn btn-sm btn-alt-primary m-1",style:{width:"auto","min-width":"60px"},onClick:w=>d.solicitarBono(c.id)},o[3]||(o[3]=[i("span",{class:"d-none d-lg-inline"},"Rechazar Abono",-1),i("i",{class:"fa fa-money-check-dollar d-lg-none"},null,-1)]),8,Qe)):N("",!0),i("button",{type:"button",class:"btn btn-sm btn-alt-success m-1",style:{width:"auto","min-width":"60px"},onClick:w=>R(c.id)},o[4]||(o[4]=[i("span",{class:"d-none d-lg-inline"},"Reservar",-1),i("i",{class:"fa fa-calendar-check d-lg-none"},null,-1)]),8,Xe),i("button",{type:"button",class:"btn btn-sm btn-alt-danger m-1",style:{width:"auto","min-width":"60px"},onClick:w=>E(c.id)},o[5]||(o[5]=[i("span",{class:"d-none d-lg-inline"},"Rechazar",-1),i("i",{class:"fa fa-times-circle d-lg-none"},null,-1)]),8,Ye)])])]),_:1})])])])]),i("div",et,[P(I(ue),{class:"py-3 fs-sm"}),P(I(we),{class:"flex-wrap py-3 fs-sm"})])]),_:1},8,["ds-data","ds-sortby"])]),_:1})])}}};var st=J(tt,[["__scopeId","data-v-43403866"]]);const ot={__name:"ConfirmarHoraView",setup(t){return(s,n)=>{const e=M("BasePageHeading");return v(),_(T,null,[P(e,{title:"Solicitudes pendientes"}),P(st)],64)}}};export{ot as default};
