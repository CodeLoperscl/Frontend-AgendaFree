import{r as f,e as b,ai as A,I as N,d as P,J as B,k as M,w as T,K as R,M as U,n as v,p as g,s as e,G as d,v as l,u as a,N as w,t as z,x as D,y as G,z as q,C as y,f as F,aj as J,h as K,m as H}from"./index.79c4e3e8.js";import{a as h}from"./axios.ab682c6b.js";const O={class:"bg-danger"},Q={class:"row g-0 bg-primary"},W={class:"hero-static col-lg-4 d-none d-lg-flex flex-column justify-content-center"},X={class:"p-4 p-xl-5 d-xl-flex justify-content-between align-items-center fs-sm"},Y={class:"fw-medium text-white-50 mb-0"},Z={class:"hero-static col-lg-8 d-flex flex-column align-items-center bg-body-light"},ss={class:"p-4 w-100 flex-grow-1 d-flex align-items-center"},es={class:"w-100"},ts={class:"text-center mb-5"},as={class:"fw-semibold text-center my-2"},os={class:"row g-0 justify-content-center"},is={class:"col-sm-8 col-xl-4"},rs={class:"mb-4"},ls={key:0,class:"invalid-feedback animated fadeIn"},ns={key:1,class:"clave-invalida"},cs={class:"px-4 py-3 w-100 d-lg-none d-flex flex-column flex-sm-row justify-content-between fs-sm text-center text-sm-start"},ds={class:"fw-medium text-black-50 py-2 mb-0"},fs={__name:"Lock3View",setup(us){const x=f(),k=b({username:"visita",password:"2843bc16"}),i=A(),E=N(),n=P(),j=B(),u="https://apirest.agendafree.cl/api/",c=f(""),_=j.params.uid;console.log(_);const I=async()=>{try{const t=await h.post(`${u}auth/login`,k);t?(x.value={headers:{"x-token":t.data.token}},L(),console.log("Usuario autenticado:",t.data.token)):console.error("Error al autenticar al usuario:",t.data)}catch(t){console.error("Error al autenticar al usuario:",t),n.push({path:"/error"})}},L=async()=>{try{const t=await h.get(`${u}users/uid/${_}`,x.value);if(!t||!t.data.personas||!t.data.personas[0])throw new Error("Respuesta inv\xE1lida");const s=t.data.personas[0].profesionales[0];if(!s||!s.habilitado||!s.ruta_api)throw new Error("Profesional no habilitado o sin ruta API");E.setUrl(s.ruta_api),c.value=t.data.personas[0],o.username=c.value.rut,console.log(c.value)}catch(t){console.error("Error al obtener datos del especialista:",t),n.push({path:"/error"})}},o=b({username:null,password:null}),V=()=>!o.isCorrect,$=F(()=>({password:{required:K,minLength:H(5),customError:V}})),r=M($,o),p=f(!1);async function C(){if(!await r.value.$validate()){console.log("incorrecto");return}h.post(u+"auth/login",o).then(s=>{s&&(console.log(s.status),s.status===200&&(sessionStorage.setItem("especialista-token",s.data.token),n.push({name:"backend-dashboard"})))}).catch(s=>{s.response.status===400&&(console.log("Error de clave"),p.value=!0)})}const S=()=>{sessionStorage.getItem("especialista-token")&&n.push({name:"backend-dashboard"})};return T(()=>o.password,t=>{t&&t.length<5&&(p.value=!1)}),R(async()=>{await I(),await S()}),U(()=>{}),(t,s)=>(v(),g("div",O,[e("div",Q,[e("div",W,[s[3]||(s[3]=e("div",{class:"p-4 p-xl-5 flex-grow-1 d-flex align-items-center"},[e("div",{class:"w-100"},[d(" Agenda"),e("span",{class:"fw-normal"},"Free"),e("p",{class:"text-white-75 me-xl-8 mt-2"})])],-1)),e("div",X,[e("p",Y,[e("strong",null,l(a(i).app.name+" "+a(i).app.version),1),d(" \xA9 "+l(a(i).app.copyright),1)]),s[2]||(s[2]=w('<ul class="list list-inline mb-0 py-2"><li class="list-inline-item"><a class="text-white-75 fw-medium" href="javascript:void(0)">Legal</a></li><li class="list-inline-item"><a class="text-white-75 fw-medium" href="javascript:void(0)">Contact</a></li><li class="list-inline-item"><a class="text-white-75 fw-medium" href="javascript:void(0)">Terms</a></li></ul>',1))])]),e("div",Z,[s[7]||(s[7]=e("div",{class:"p-3 w-100 d-lg-none text-center"},null,-1)),e("div",ss,[e("div",es,[e("div",ts,[s[4]||(s[4]=w('<p class="mb-3"><i class="fa fa-2x fa-circle-notch text-primary-light"></i></p><h1 class="fw-bold mb-2">Iniciar sesion</h1><p class="fw-medium text-muted mb-5"> Por favor, ingrese su contrase\xF1a para ingresar a su cuenta </p><img class="img-avatar img-avatar96" src="'+J+'" alt="">',4)),e("p",as,l(c.value.email),1)]),e("div",os,[e("div",is,[e("form",{onSubmit:z(C,["prevent"])},[e("div",rs,[D(e("input",{type:"password",class:q(["form-control form-control-lg form-control-alt py-3",{"is-invalid":a(r).password.$errors.length}]),id:"lock-password",name:"lock-password",placeholder:"Contrase\xF1a..","onUpdate:modelValue":s[0]||(s[0]=m=>o.password=m),onBlur:s[1]||(s[1]=(...m)=>a(r).password.$touch&&a(r).password.$touch(...m))},null,34),[[G,o.password]]),a(r).password.$errors.length?(v(),g("div",ls," Por favor, ingresa tu contrase\xF1a ")):y("",!0),p.value?(v(),g("div",ns," La contrase\xF1a ingresada es incorrecta. ")):y("",!0)]),s[5]||(s[5]=e("div",{class:"text-center"},[e("button",{type:"submit",class:"btn btn-lg btn-alt-success"},[e("i",{class:"fa fa-fw fa-lock-open me-1 opacity-50"}),d(" Ingresar ")])],-1))],32)])])])]),e("div",cs,[e("p",ds,[e("strong",null,l(a(i).app.name+" "+a(i).app.version),1),d(" \xA9 "+l(a(i).app.copyright),1)]),s[6]||(s[6]=w('<ul class="list list-inline py-2 mb-0"><li class="list-inline-item"><a class="text-muted fw-medium" href="javascript:void(0)">Legal</a></li><li class="list-inline-item"><a class="text-muted fw-medium" href="javascript:void(0)">Contact</a></li><li class="list-inline-item"><a class="text-muted fw-medium" href="javascript:void(0)">Terms</a></li></ul>',1))])])])]))}};export{fs as default};
